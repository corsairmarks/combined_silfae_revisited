namespace = holofrixit_evt

# flag mod as active
event = {
	id = holofrixit_evt.13
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		NOT = { has_global_flag = holofrixit_revisited_installed }
	}
	immediate = {
		set_global_flag = holofrixit_revisited_installed
	}
}

# triggered by empire_init_capital_planet
# ROOT = planet, capital
# FROM = species, founder
planet_event = {
	id = holofrixit_evt.1
	hide_window = yes
	is_triggered_only = yes
	pre_triggers = {
		has_owner = yes
		is_homeworld = yes
		is_capital = yes
	}
	trigger = {
		owner = { has_origin = origin_holofrixit }
	}
	immediate = {
		# disable default initialization
		set_planet_flag = special_start_planet
	}
}

# triggered by empire_init_capital_planet
# ROOT = planet, capital
# FROM = species, founder
planet_event = {
	id = holofrixit_evt.2
	hide_window = yes
	is_triggered_only = yes
	pre_triggers = {
		has_owner = yes
		is_homeworld = yes
		is_capital = yes
	}
	trigger = {
		owner = { has_origin = origin_holofrixit }
	}
	immediate = {
		if = {
			limit = {
				has_planet_flag = planet_earth
				owner = {
					NOR = {
						has_origin = origin_shattered_ring	#setup in initializer
						has_origin = origin_remnants		#custom blockers
					}
				}
			}
			generate_earth_deposits_and_blockers = yes
		}
		else = {
			generate_start_deposits_and_blockers = yes
		}
		generate_start_buildings_and_districts = yes
		add_building = building_polarizing_nexus_1
		# swap food deposits for energy deposits
		# unfortunately check_modifier_value doesn't work on deposits
		every_deposit = {
			limit = { has_deposit_category = deposit_cat_food }
			if = {
				limit = {
					OR = {
						is_deposit_type = d_black_soil
						is_deposit_type = d_teeming_reef
						is_deposit_type = d_marvelous_oasis
						is_deposit_type = d_tropical_island
						is_deposit_type = d_fungal_forest
					}
				}
				PREV = { add_random_3_generator_district_deposit = yes }
				remove_deposit = yes
			}
			else_if = {
				limit = {
					OR = {
						is_deposit_type = d_fungal_caves
						is_deposit_type = d_lush_jungle
						is_deposit_type = d_fertile_lands
						is_deposit_type = d_great_river
					}
				}
				PREV = { add_random_2_generator_district_deposit = yes }
				remove_deposit = yes
			}
			else_if = {
				limit = {
					OR = {
						is_deposit_type = d_lichen_fields
						is_deposit_type = d_bountiful_plains
						is_deposit_type = d_rugged_woods
						is_deposit_type = d_green_hills
						is_deposit_type = d_forgiving_tundra
						is_deposit_type = d_boggy_fens
						is_deposit_type = d_nutritious_mudland
						is_deposit_type = d_natural_farmland
					}
				}
				PREV = { add_random_1_generator_district_deposit = yes }
				remove_deposit = yes
			}
			else = {
				log_error = "unable to replace food deposit of type: \\[This.GetName]"
			}
		}
		# swap farming districts for generator districts
		while = {
			limit = {
				num_districts = {
					type = district_farming
					value > 0
				}
			}
			remove_district = district_farming
			add_district = district_generator
		}
		generate_holofrixit_start_pops = yes
		generate_home_planet_final_pass = yes
	}
}

# triggered by empire_init_add_technologies
# ROOT = country
country_event = {
	id = holofrixit_evt.3
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_origin = origin_holofrixit
	}
	immediate = {
		give_technology = { tech = tech_administrative_ai			message = no }
		give_technology = { tech = tech_self_aware_logic			message = no }
		give_technology = { tech = tech_powered_exoskeletons		message = no }
		give_technology = { tech = tech_robotic_workers				message = no }
		# give_technology = { tech = tech_synthetic_leaders			message = no }
		give_technology = { tech = tech_extradimensional_weapon_1	message = no }
		give_technology = { tech = tech_holocastes					message = no }
		# TODO - too early
		# set_policy = {
		# 	policy = artificial_intelligence_policy
		# 	option = ai_servitude
		# 	cooldown = no
		# }
		add_modifier = { modifier = holofrixit_mod }
	}
}